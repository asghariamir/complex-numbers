<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complex Numbers - Mathswell</title>
    <link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
    <link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f7faf9;
            color: #212121;
            line-height: 1.6;
        }

        /* Mathswell Navigation */
        .mathswell-nav {
            display: flex;
            justify-content: center;
            margin: .75rem 0 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .mathswell-nav .mw-link {
            display: inline-flex;
            align-items: center;
            gap: .45rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            color: #0f766e;
            padding: .3rem .7rem;
            border-radius: 999px;
            background: rgba(255,255,255,.95);
            box-shadow: 0 2px 8px rgba(0,0,0,.08);
            transition: all 0.3s ease;
        }

        .mathswell-nav .mw-link:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,.12);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #4b5563;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: #e6fffb;
        }

        .tab-button.active {
            background: #0f766e;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards and Sections */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .intro-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .intro-header h1 {
            font-size: 2.5em;
            color: #0f766e;
            margin-bottom: 8px;
        }

        .intro-header p {
            font-size: 1.2em;
            color: #4b5563;
        }

        .concept-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .concept-card {
            background: linear-gradient(135deg, #e6fffb 0%, #f0fffe 100%);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .concept-card h3 {
            color: #0f766e;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        /* Interactive Demo */
        .interactive-demo {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .demo-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 200px;
        }

        .slider-group label {
            font-weight: 600;
            color: #4b5563;
            min-width: 30px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0f766e;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0f766e;
            cursor: pointer;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: #0f766e;
        }

        .demo-button {
            padding: 10px 20px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            background: #10b981;
            transform: translateY(-1px);
        }

        .demo-result {
            background: #e6fffb;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .math-display {
            margin: 8px 0;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }

        .nav-btn {
            padding: 14px 28px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 999px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #10b981;
            transform: translateX(4px);
        }

        /* Example boxes */
        .example-box {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .example-step {
            margin: 8px 0;
            padding-left: 20px;
        }

        /* User input styles */
        .user-answer-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
        }

        .user-answer-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .preset-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .preset-pill {
            padding: 8px 16px;
            background: #e6fffb;
            border: 2px solid #10b981;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            color: #0f766e;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preset-pill:hover {
            background: #10b981;
            color: white;
        }

        /* Complex Plane Canvas */
        .plane-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        canvas {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            cursor: crosshair;
        }

        .plane-controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-button {
            padding: 10px 20px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: #10b981;
        }

        .control-button.secondary {
            background: #4b5563;
        }

        .control-button.secondary:hover {
            background: #6b7280;
        }

        /* Info boxes */
        .info-box {
            background: #f0fffe;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #0f766e;
            margin-bottom: 8px;
        }

        .summary-box {
            background: linear-gradient(135deg, #e6fffb 0%, #f0fffe 100%);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-top: 32px;
        }

        .summary-box h3 {
            color: #0f766e;
            margin-bottom: 12px;
        }

        /* Formula display */
        .formula-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }

        /* Problem selector */
        .problem-selector {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .form-choice {
            display: flex;
            gap: 16px;
            margin-top: 12px;
        }

        .form-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        /* Feedback boxes */
        .feedback-box {
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .feedback-box.correct {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }

        .feedback-box.trying {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            color: #92400e;
        }

        .feedback-box.incorrect {
            background: #fed7aa;
            border: 2px solid #fb923c;
            color: #9a3412;
        }

        /* Loading and AI status */
        .ai-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #e6fffb;
            border-radius: 999px;
            font-size: 13px;
            color: #0f766e;
            margin-left: 12px;
        }

        .loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid #10b981;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Unit circle for powers of i */
        .unit-circle-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .unit-circle-visual {
            flex: 1;
            min-width: 300px;
        }

        .powers-list {
            flex: 1;
            min-width: 200px;
        }

        /* Disclaimer */
        .disclaimer {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 14px;
            color: #92400e;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .intro-header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
            }
        }

        .show-solution-btn {
            background: #4b5563;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 12px;
        }

        .show-solution-btn:hover {
            background: #6b7280;
        }

        .challenge-btn {
            background: #f59e0b;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 12px;
        }

        .challenge-btn:hover {
            background: #d97706;
        }
    </style>
</head>
<body>
    <!-- Mathswell Navigation -->
    <div class="mathswell-nav">
        <a href="/" class="mw-link">
            <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
            <span>MATHSWELL</span>
        </a>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" data-tab="introduction">Introduction</button>
            <button class="tab-button" data-tab="algebraic">Algebraic Explorer</button>
            <button class="tab-button" data-tab="geometric">Geometric View</button>
            <button class="tab-button" data-tab="exploration">Exploration</button>
        </div>

        <!-- Introduction Tab -->
        <div id="introduction" class="tab-content active">
            <div class="intro-header">
                <h1>Complex Numbers</h1>
                <p>Impossible numbers that create endless possibilities</p>
            </div>

            <!-- Concept Cards -->
            <div class="concept-cards">
                <div class="concept-card">
                    <h3>The Imaginary Unit <em>i</em></h3>
                    <p>We define <strong><em>i</em></strong> as something whose square is -1:</p>
                    <div class="math-display" id="i-definition"></div>
                    <p>This "impossible" idea unlocks a whole new mathematical universe!</p>
                </div>

                <div class="concept-card">
                    <h3>Complex Numbers: a + bi</h3>
                    <p>Every complex number combines real and imaginary parts:</p>
                    <div class="math-display" id="complex-form"></div>
                    <p>They follow all arithmetic rules, always simplifying to this form.</p>
                </div>
            </div>

            <!-- Interactive Demo 1: Factoring x² + c -->
            <div class="interactive-demo">
                <h2>Factoring <span id="factor-header"></span></h2>
                <p>See how complex numbers let us factor any quadratic, even when c is positive!</p>
                
                <div class="demo-controls">
                    <div class="slider-group">
                        <label>c =</label>
                        <input type="range" class="slider" id="c-slider" min="-10" max="10" value="1" step="1">
                        <span class="slider-value" id="c-value">1</span>
                    </div>
                </div>
                
                <div class="demo-result">
                    <div class="math-display" id="factor-display"></div>
                    <div class="math-display" id="factor-roots"></div>
                </div>
            </div>

            <!-- Interactive Demo 2: Solving Quadratics -->
            <div class="interactive-demo">
                <h2>Solving Any Quadratic</h2>
                <p>When the discriminant is negative, we can now find solutions using complex numbers!</p>
                
                <div style="margin-top: 20px;">
                    <p><strong>Try your own quadratic:</strong></p>
                    <div class="demo-controls">
                        <div class="slider-group">
                            <label>b =</label>
                            <input type="range" class="slider" id="b-slider" min="-10" max="10" value="-10" step="1">
                            <span class="slider-value" id="b-value">-10</span>
                        </div>
                        <div class="slider-group">
                            <label>c =</label>
                            <input type="range" class="slider" id="c2-slider" min="1" max="50" value="40" step="1">
                            <span class="slider-value" id="c2-value">40</span>
                        </div>
                    </div>
                    
                    <div class="demo-result">
                        <div class="math-display" id="quadratic-equation"></div>
                        <div class="math-display" id="discriminant-display"></div>
                        <div class="math-display" id="quadratic-roots"></div>
                        <div class="math-display" id="quadratic-explanation"></div>
                    </div>
                </div>
            </div>

            <!-- Summary Box -->
            <div class="summary-box">
                <h3>Key Insights</h3>
                <p><strong>1. Accepting the impossible:</strong> By defining i such that i² = -1, we can solve previously unsolvable equations.</p>
                <p><strong>2. Solving any quadratic:</strong> When the discriminant (b² - 4ac) is negative, we use √|discriminant| · i for the solutions.</p>
                <p><strong>3. From algebra to geometry:</strong> Complex numbers connect algebra with geometry in beautiful ways we'll explore next.</p>
            </div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons">
                <button class="nav-btn" onclick="switchTab('algebraic')">
                    Try Algebraic Explorer →
                </button>
                <button class="nav-btn" onclick="switchTab('geometric')">
                    Explore Geometry →
                </button>
            </div>
        </div>

        <!-- Algebraic Explorer Tab -->
        <div id="algebraic" class="tab-content">
            <div class="card">
                <h2>Algebraic Explorer</h2>
                <p>Master complex number arithmetic step by step</p>
                
                <div class="info-box">
                    <h4>Remember: The algebra is exactly the same!</h4>
                    <p>All algebraic rules you know still apply. The only new rule: whenever you see <span id="i-squared"></span>, replace it with -1.</p>
                </div>
            </div>

            <!-- Container 1: Worked Examples -->
            <div class="card">
                <h3>Worked Examples</h3>
                <p>Let's see how complex arithmetic works:</p>
                
                <div class="example-box">
                    <h4>Example 1: Multiplication</h4>
                    <div class="math-display" id="example1-problem"></div>
                    <div class="example-step" id="example1-step1"></div>
                    <div class="example-step" id="example1-step2"></div>
                    <div class="example-step" id="example1-step3"></div>
                    <div class="example-step" id="example1-result"></div>
                </div>
                
                <div class="example-box">
                    <h4>Example 2: Division</h4>
                    <div class="math-display" id="example2-problem"></div>
                    <div class="example-step" id="example2-step1"></div>
                    <div class="example-step" id="example2-step2"></div>
                    <div class="example-step" id="example2-result"></div>
                </div>
            </div>

            <!-- Container 2: Powers of i - Visual Unit Circle -->
            <div class="card">
                <h3>Powers of <em>i</em> on the Unit Circle</h3>
                <p>Watch how powers of <em>i</em> rotate around the circle, repeating every 4 steps:</p>
                
                <div class="unit-circle-container">
                    <div class="unit-circle-visual">
                        <canvas id="powers-circle" width="300" height="300"></canvas>
                    </div>
                    <div class="powers-list">
                        <div id="powers-display"></div>
                    </div>
                </div>
                
                <div class="demo-controls" style="margin-top: 20px;">
                    <div class="slider-group">
                        <label>Power:</label>
                        <input type="range" class="slider" id="power-slider" min="0" max="12" value="0" step="1">
                        <span class="slider-value" id="power-value">0</span>
                    </div>
                    <button class="demo-button" onclick="animatePowers()">Animate Cycle</button>
                </div>
                
                <p style="margin-top: 16px;">Notice the pattern: <span id="power-pattern"></span></p>
            </div>

            <!-- Container 3: Practice Problems -->
            <div class="card">
                <h3>Your Turn: Practice Problems</h3>
                <p>Try simplifying these expressions to the form a + bi:</p>
                
                <div class="preset-pills">
                    <button class="preset-pill" onclick="setProblem('(3+2i)(2-i)', '8+i')">Try: (3+2i)(2-i)</button>
                    <button class="preset-pill" onclick="setProblem('(1+i)^3', '-2+2i')">Try: (1+i)³</button>
                    <button class="preset-pill" onclick="setProblem('(4-3i)/(2+i)', '1-2i')">Try: (4-3i)/(2+i)</button>
                    <button class="preset-pill" onclick="setProblem('i^23', '-i')">Try: i²³</button>
                </div>
                
                <div style="margin-top: 16px;">
                    <div class="math-display" id="current-problem"></div>
                    <input type="text" class="user-answer-input" id="user-answer" 
                           placeholder="Enter your answer in form a + bi (e.g., 3+4i or 3-4i)">
                    <button class="demo-button" onclick="checkAnswer()">Check Answer</button>
                    <div id="practice-feedback"></div>
                </div>
            </div>

            <!-- Container 4: Build Your Own -->
            <div class="card">
                <h3>Create Your Own Problem</h3>
                <p>Choose an operation and let me create numbers for you to work with:</p>
                
                <div class="preset-pills">
                    <button class="preset-pill" onclick="generateProblem('add')">Addition</button>
                    <button class="preset-pill" onclick="generateProblem('multiply')">Multiplication</button>
                    <button class="preset-pill" onclick="generateProblem('divide')">Division</button>
                    <button class="preset-pill" onclick="generateProblem('power')">Powers</button>
                </div>
                
                <div style="margin-top: 16px;">
                    <div class="math-display" id="generated-problem"></div>
                    <input type="text" class="user-answer-input" id="generated-answer" 
                           placeholder="Enter your answer in form a + bi">
                    <button class="demo-button" onclick="checkGeneratedAnswer()">Check Answer</button>
                    <div id="generated-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Geometric View Tab -->
        <div id="geometric" class="tab-content">
            <div class="card">
                <h2>Two Forms, One Number</h2>
                
                <div class="plane-container">
                    <h3>Interactive Complex Plane</h3>
                    <p>Click anywhere to place a complex number and see both forms:</p>
                    <canvas id="representation-plane" width="400" height="400"></canvas>
                    
                    <div style="text-align: center; margin-top: 16px;">
                        <div><strong>Rectangular:</strong> <span id="rect-display">a + bi</span></div>
                        <div><strong>Polar:</strong> <span id="polar-display">r(cos θ + i sin θ)</span></div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <h4>Converting Between Forms</h4>
                    <div id="conversion-formulas"></div>
                </div>
            </div>

            <div class="card">
                <h2>Multiplication: Two Perspectives</h2>
                
                <div class="info-box">
                    <h4>Rectangular Form</h4>
                    <div id="rect-mult-formula"></div>
                    <p>Expand and use i² = -1</p>
                </div>
                
                <div class="info-box">
                    <h4>Polar Form</h4>
                    <div id="polar-mult-formula"></div>
                    <p>Multiply magnitudes, add angles - revealing rotation and scaling!</p>
                </div>
            </div>

            <div class="summary-box">
                <h3>The Beautiful Connection</h3>
                <p>Complex multiplication becomes much clearer in polar form:</p>
                <p>• Multiply the distances from the origin</p>
                <p>• Add the angles</p>
                <p>This reveals the deep geometric nature of complex arithmetic!</p>
            </div>
        </div>

        <!-- Exploration Tab -->
        <div id="exploration" class="tab-content">
            <div class="card">
                <h2>Which Form to Use?</h2>
                <p>Let's explore when rectangular or polar form is more convenient</p>
                
                <div class="problem-selector">
                    <h3>Problem: <span id="exploration-problem"></span></h3>
                    <p>Which form would you choose?</p>
                    
                    <div class="form-choice">
                        <label class="form-radio">
                            <input type="radio" name="form-choice" value="rectangular">
                            Rectangular (a + bi)
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="form-choice" value="polar">
                            Polar r(cos θ + i sin θ)
                        </label>
                    </div>
                    
                    <button class="demo-button" onclick="showBothApproaches()">See Both Approaches</button>
                    
                    <div id="approach-comparison" style="display:none; margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="example-box">
                                <h4>Rectangular Approach</h4>
                                <div id="rect-approach"></div>
                            </div>
                            <div class="example-box">
                                <h4>Polar Approach</h4>
                                <div id="polar-approach"></div>
                            </div>
                        </div>
                        <div class="feedback-box correct" style="margin-top: 16px;">
                            <p id="approach-feedback"></p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="control-button" onclick="nextExplorationProblem()">Try Another Problem</button>
                </div>
            </div>

            <div class="card">
                <h2>Finding Roots: <span id="roots-equation"></span></h2>
                <p>Polar form excels at finding all solutions to equations like this</p>
                
                <div style="margin-top: 20px;">
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label>n = </label>
                            <input type="number" id="n-value" value="4" min="2" max="12" 
                                   style="width: 60px; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px;"
                                   onchange="updateRootsDisplay()">
                        </div>
                        <button class="demo-button" onclick="findRoots()">
                            Find All Roots
                        </button>
                    </div>
                </div>
                
                <div id="roots-result" style="display:none; margin-top: 20px;">
                    <div class="example-box">
                        <h4>All Solutions of <span id="roots-eq-display"></span></h4>
                        <div id="roots-list"></div>
                    </div>
                    <canvas id="roots-plane" width="350" height="350" style="margin-top: 20px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTab = 'introduction';
        let currentProblem = '(3+2i)(2-i)';
        let currentProblemAnswer = '8+i';
        let generatedProblem = '';
        let generatedAnswer = '';
        let attemptsCount = 0;
        let explorationProblems = [
            {problem: '(2+3i) + (1-2i)', bestForm: 'rectangular', type: 'addition'},
            {problem: '(1+i)^{10}', bestForm: 'polar', type: 'power'},
            {problem: '\\frac{3+4i}{1-i}', bestForm: 'both', type: 'division'},
            {problem: '(2-i) - (3+2i)', bestForm: 'rectangular', type: 'subtraction'}
        ];
        let currentExplorationIndex = 0;
        let powerAnimationId = null;
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Introduction tab formulas
            katex.render("i^2 = -1", document.getElementById('i-definition'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("z = a + bi", document.getElementById('complex-form'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("x^2 + c", document.getElementById('factor-header'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Algebraic tab
            katex.render("i^2", document.getElementById('i-squared'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Initialize examples
            showWorkedExamples();
            initPowersCircle();
            updatePowerDisplay(0);
            setProblem('(3+2i)(2-i)', '8+i');
            
            // Geometric tab
            showConversionFormulas();
            showMultiplicationFormulas();
            
            // Exploration tab
            loadExplorationProblem();
            updateRootsDisplay();
            
            // Initialize displays
            updateFactoring();
            updateQuadratic();
            
            // Add slider listeners
            document.getElementById('c-slider').addEventListener('input', updateFactoring);
            document.getElementById('b-slider').addEventListener('input', updateQuadratic);
            document.getElementById('c2-slider').addEventListener('input', updateQuadratic);
            document.getElementById('power-slider').addEventListener('input', function() {
                const power = parseInt(this.value);
                document.getElementById('power-value').textContent = power;
                updatePowerDisplay(power);
            });
            
            // Initialize interactive plane
            initInteractivePlane();
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
        }

        // Add tab button listeners
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        // Introduction tab functions
        function updateFactoring() {
            const c = parseInt(document.getElementById('c-slider').value);
            document.getElementById('c-value').textContent = c;
            
            const factorDisplay = document.getElementById('factor-display');
            const rootsDisplay = document.getElementById('factor-roots');
            
            let factorLatex, rootsLatex;
            
            if (c > 0) {
                const sqrtC = Math.sqrt(c);
                let rootStr;
                if (Number.isInteger(sqrtC)) {
                    rootStr = sqrtC.toString();
                } else {
                    rootStr = `\\sqrt{${c}}`;
                }
                
                factorLatex = `x^2 + ${c} = \\left(x + ${rootStr}i\\right)\\left(x - ${rootStr}i\\right)`;
                rootsLatex = `\\text{Roots: } x = \\pm ${rootStr}i`;
            } else if (c < 0) {
                const absC = Math.abs(c);
                const sqrtAbsC = Math.sqrt(absC);
                let rootStr;
                if (Number.isInteger(sqrtAbsC)) {
                    rootStr = sqrtAbsC.toString();
                } else {
                    rootStr = `\\sqrt{${absC}}`;
                }
                
                factorLatex = `x^2 - ${absC} = \\left(x + ${rootStr}\\right)\\left(x - ${rootStr}\\right)`;
                rootsLatex = `\\text{Roots: } x = \\pm ${rootStr}`;
            } else {
                factorLatex = `x^2 = x \\cdot x`;
                rootsLatex = `\\text{Root: } x = 0 \\text{ (double root)}`;
            }
            
            katex.render(factorLatex, factorDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render(rootsLatex, rootsDisplay, {
                displayMode: false,
                throwOnError: false
            });
        }

        function updateQuadratic() {
            const b = parseInt(document.getElementById('b-slider').value);
            const c = parseInt(document.getElementById('c2-slider').value);
            document.getElementById('b-value').textContent = b;
            document.getElementById('c2-value').textContent = c;
            
            const equationDisplay = document.getElementById('quadratic-equation');
            const discriminantDisplay = document.getElementById('discriminant-display');
            const rootsDisplay = document.getElementById('quadratic-roots');
            const explanationDisplay = document.getElementById('quadratic-explanation');
            
            const bStr = b === 0 ? '' : (b > 0 ? `+ ${b}x` : `- ${Math.abs(b)}x`);
            const cStr = c === 0 ? '' : (c > 0 ? `+ ${c}` : `- ${Math.abs(c)}`);
            const eqLatex = `x^2 ${bStr} ${cStr} = 0`;
            
            katex.render(eqLatex, equationDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            const disc = b * b - 4 * c;
            let discLatex = `\\text{Discriminant: } b^2 - 4ac = ${disc}`;
            
            katex.render(discLatex, discriminantDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            let rootsLatex;
            let explanationLatex = '';
            
            if (disc < 0) {
                const absDisc = Math.abs(disc);
                const sqrtAbsDisc = Math.sqrt(absDisc);
                
                explanationLatex = `\\text{Since discriminant is negative, we use } \\sqrt{${absDisc}} \\cdot i`;
                
                if (Number.isInteger(sqrtAbsDisc) && sqrtAbsDisc % 2 === 0) {
                    const realPart = -b / 2;
                    const imagPart = sqrtAbsDisc / 2;
                    rootsLatex = `x = ${realPart} \\pm ${imagPart}i`;
                } else if (Number.isInteger(absDisc)) {
                    rootsLatex = `x = \\frac{${-b} \\pm \\sqrt{${absDisc}} \\cdot i}{2}`;
                } else {
                    const realPart = (-b / 2).toFixed(2);
                    const imagPart = (sqrtAbsDisc / 2).toFixed(2);
                    rootsLatex = `x = ${realPart} \\pm ${imagPart}i`;
                }
            } else if (disc > 0) {
                const sqrtDisc = Math.sqrt(disc);
                if (Number.isInteger(sqrtDisc)) {
                    const root1 = (-b + sqrtDisc) / 2;
                    const root2 = (-b - sqrtDisc) / 2;
                    rootsLatex = `x = ${root1}, ${root2}`;
                } else if (Number.isInteger(disc)) {
                    rootsLatex = `x = \\frac{${-b} \\pm \\sqrt{${disc}}}{2}`;
                } else {
                    const root1 = ((-b + sqrtDisc) / 2).toFixed(2);
                    const root2 = ((-b - sqrtDisc) / 2).toFixed(2);
                    rootsLatex = `x = ${root1}, ${root2}`;
                }
                explanationLatex = `\\text{Discriminant is positive, so we have two real roots}`;
            } else {
                const root = -b / 2;
                rootsLatex = `x = ${root}`;
                explanationLatex = `\\text{Discriminant is zero, so we have one repeated root}`;
            }
            
            katex.render(rootsLatex, rootsDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            if (explanationLatex) {
                katex.render(explanationLatex, explanationDisplay, {
                    displayMode: false,
                    throwOnError: false
                });
            }
        }

        // Algebraic Explorer functions
        function showWorkedExamples() {
            // Example 1: Multiplication
            katex.render("(2+3i)(1-i)", document.getElementById('example1-problem'), {
                displayMode: true,
                throwOnError: false
            });
            
            katex.render("= 2 \\cdot 1 + 2 \\cdot (-i) + 3i \\cdot 1 + 3i \\cdot (-i)", 
                document.getElementById('example1-step1'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("= 2 - 2i + 3i - 3i^2", document.getElementById('example1-step2'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("= 2 - 2i + 3i - 3(-1) = 2 + i + 3", document.getElementById('example1-step3'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("= 5 + i", document.getElementById('example1-result'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Example 2: Division
            katex.render("\\frac{3+2i}{1-i}", document.getElementById('example2-problem'), {
                displayMode: true,
                throwOnError: false
            });
            
            katex.render("\\text{Multiply by } \\frac{1+i}{1+i}: \\quad \\frac{(3+2i)(1+i)}{(1-i)(1+i)}", 
                document.getElementById('example2-step1'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("= \\frac{3 + 3i + 2i + 2i^2}{1 - i^2} = \\frac{3 + 5i - 2}{1 + 1} = \\frac{1 + 5i}{2}", 
                document.getElementById('example2-step2'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("= \\frac{1}{2} + \\frac{5}{2}i", document.getElementById('example2-result'), {
                displayMode: false,
                throwOnError: false
            });
        }

        function initPowersCircle() {
            const canvas = document.getElementById('powers-circle');
            if (!canvas) return;
            drawPowerCircle(0);
        }

        function drawPowerCircle(power) {
            const canvas = document.getElementById('powers-circle');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = 100;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw axes
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(centerX - radius - 20, centerY);
            ctx.lineTo(centerX + radius + 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - radius - 20);
            ctx.lineTo(centerX, centerY + radius + 20);
            ctx.stroke();
            
            // Draw unit circle
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.stroke();
            
            // Mark the four key positions
            const positions = [
                {x: radius, y: 0, label: '1', power: 0},
                {x: 0, y: -radius, label: 'i', power: 1},
                {x: -radius, y: 0, label: '-1', power: 2},
                {x: 0, y: radius, label: '-i', power: 3}
            ];
            
            positions.forEach((pos, idx) => {
                const x = centerX + pos.x;
                const y = centerY + pos.y;
                
                // Draw point
                ctx.fillStyle = '#e5e7eb';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                // Label
                ctx.fillStyle = '#4b5563';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelX = x + (pos.x === 0 ? 0 : pos.x > 0 ? 20 : -20);
                const labelY = y + (pos.y === 0 ? 0 : pos.y > 0 ? 20 : -20);
                ctx.fillText(pos.label, labelX, labelY);
            });
            
            // Highlight current power position
            const currentPos = positions[power % 4];
            const currentX = centerX + currentPos.x;
            const currentY = centerY + currentPos.y;
            
            // Draw vector from origin
            ctx.strokeStyle = '#0f766e';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            // Draw highlighted point
            ctx.fillStyle = '#0f766e';
            ctx.beginPath();
            ctx.arc(currentX, currentY, 8, 0, 2 * Math.PI);
            ctx.fill();
        }

        function updatePowerDisplay(power) {
            drawPowerCircle(power);
            
            const powersDisplay = document.getElementById('powers-display');
            const values = ['1', 'i', '-1', '-i'];
            const currentValue = values[power % 4];
            
            let html = '<div style="text-align: left;">';
            for (let i = 0; i <= Math.min(power, 7); i++) {
                const value = values[i % 4];
                const isBold = i === power;
                html += `<div style="${isBold ? 'font-weight: bold; color: #0f766e;' : ''}">i<sup>${i}</sup> = ${value}</div>`;
            }
            if (power > 7) {
                html += '<div>...</div>';
                html += `<div style="font-weight: bold; color: #0f766e;">i<sup>${power}</sup> = ${currentValue}</div>`;
            }
            html += '</div>';
            
            powersDisplay.innerHTML = html;
            
            // Update pattern text
            const patternText = `i^0 = 1, i^1 = i, i^2 = -1, i^3 = -i, i^4 = 1, ... (repeats every 4)`;
            document.getElementById('power-pattern').textContent = patternText;
        }

        function animatePowers() {
            if (powerAnimationId) {
                clearInterval(powerAnimationId);
                powerAnimationId = null;
                return;
            }
            
            let currentPower = 0;
            powerAnimationId = setInterval(() => {
                currentPower = (currentPower + 1) % 8;
                document.getElementById('power-slider').value = currentPower;
                document.getElementById('power-value').textContent = currentPower;
                updatePowerDisplay(currentPower);
                
                if (currentPower === 7) {
                    clearInterval(powerAnimationId);
                    powerAnimationId = null;
                }
            }, 500);
        }

        function setProblem(problem, answer) {
            currentProblem = problem;
            currentProblemAnswer = answer;
            attemptsCount = 0;
            
            const display = document.getElementById('current-problem');
            
            let latex = problem.replace(/\^3/g, '^{3}').replace(/\^23/g, '^{23}');
            
            katex.render(latex, display, {
                displayMode: true,
                throwOnError: false
            });
            
            document.getElementById('user-answer').value = '';
            document.getElementById('practice-feedback').innerHTML = '';
        }

        function normalizeAnswer(answer) {
            // Remove spaces and normalize format
            return answer.replace(/\s/g, '').replace(/\+-/g, '-').replace(/--/g, '+');
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('user-answer').value;
            const feedback = document.getElementById('practice-feedback');
            
            if (!userAnswer) {
                feedback.innerHTML = '<div class="feedback-box trying">Please enter your answer.</div>';
                return;
            }
            
            attemptsCount++;
            
            const normalized = normalizeAnswer(userAnswer);
            const expectedNorm = normalizeAnswer(currentProblemAnswer);
            
            if (normalized === expectedNorm || normalized === expectedNorm.replace('+', '-').replace('-', '+')) {
                feedback.innerHTML = '<div class="feedback-box correct">Excellent work! Your answer is correct.</div>';
                attemptsCount = 0;
            } else {
                if (attemptsCount === 1) {
                    feedback.innerHTML = `
                        <div class="feedback-box trying">
                            That doesn't match the expected answer. Would you like to try again?
                            <button class="show-solution-btn" onclick="showSolution()">Show Solution</button>
                        </div>`;
                } else {
                    feedback.innerHTML = `
                        <div class="feedback-box trying">
                            Still not matching. Remember to check your arithmetic carefully.
                            <button class="show-solution-btn" onclick="showSolution()">Show Solution</button>
                            <button class="challenge-btn" onclick="challengeAnswer()">I think I'm right</button>
                        </div>`;
                }
            }
        }

        function showSolution() {
            const feedback = document.getElementById('practice-feedback');
            feedback.innerHTML = `
                <div class="feedback-box correct">
                    The answer is: <strong>${currentProblemAnswer}</strong>
                    <br>Try working through it step by step, or move on to another problem!
                </div>`;
        }

        function challengeAnswer() {
            const userAnswer = document.getElementById('user-answer').value;
            const feedback = document.getElementById('practice-feedback');
            feedback.innerHTML = `
                <div class="feedback-box trying">
                    You entered: <strong>${userAnswer}</strong>
                    <br>The expected answer is: <strong>${currentProblemAnswer}</strong>
                    <br>If you believe your answer is equivalent, try simplifying it further or check your arithmetic.
                    Sometimes answers can be written in different but equivalent forms!
                </div>`;
        }

        function generateProblem(operation) {
            const a = Math.floor(Math.random() * 5) - 2;
            const b = Math.floor(Math.random() * 5) - 2;
            const c = Math.floor(Math.random() * 5) - 2;
            const d = Math.floor(Math.random() * 5) - 2;
            
            let problemText = '';
            let answer = '';
            
            if (operation === 'add') {
                problemText = `(${a}${b>=0?'+':''}${b}i) + (${c}${d>=0?'+':''}${d}i)`;
                const realPart = a + c;
                const imagPart = b + d;
                answer = `${realPart}${imagPart>=0?'+':''}${imagPart}i`;
            } else if (operation === 'multiply') {
                problemText = `(${a}${b>=0?'+':''}${b}i)(${c}${d>=0?'+':''}${d}i)`;
                const realPart = a*c - b*d;
                const imagPart = a*d + b*c;
                answer = `${realPart}${imagPart>=0?'+':''}${imagPart}i`;
            } else if (operation === 'divide') {
                if (c === 0 && d === 0) {
                    c = 1; // Avoid division by zero
                }
                problemText = `\\frac{${a}${b>=0?'+':''}${b}i}{${c}${d>=0?'+':''}${d}i}`;
                const denom = c*c + d*d;
                const realPart = (a*c + b*d) / denom;
                const imagPart = (b*c - a*d) / denom;
                answer = `${realPart.toFixed(2)}${imagPart>=0?'+':''}${imagPart.toFixed(2)}i`;
            } else if (operation === 'power') {
                const n = Math.floor(Math.random() * 3) + 2;
                problemText = `(${a}${b>=0?'+':''}${b}i)^{${n}}`;
                // Calculate the actual answer (simplified for demo)
                answer = 'Check your work!';
            }
            
            generatedProblem = problemText;
            generatedAnswer = answer;
            
            katex.render(problemText, document.getElementById('generated-problem'), {
                displayMode: true,
                throwOnError: false
            });
            
            document.getElementById('generated-answer').value = '';
            document.getElementById('generated-feedback').innerHTML = '';
        }

        function checkGeneratedAnswer() {
            const userAnswer = document.getElementById('generated-answer').value;
            const feedback = document.getElementById('generated-feedback');
            
            if (!userAnswer) {
                feedback.innerHTML = '<div class="feedback-box trying">Please enter your answer.</div>';
                return;
            }
            
            if (generatedAnswer === 'Check your work!') {
                feedback.innerHTML = '<div class="feedback-box correct">Good practice! Try generating another problem to continue.</div>';
            } else {
                const normalized = normalizeAnswer(userAnswer);
                const expectedNorm = normalizeAnswer(generatedAnswer);
                
                if (normalized === expectedNorm) {
                    feedback.innerHTML = '<div class="feedback-box correct">Excellent! Your answer is correct.</div>';
                } else {
                    feedback.innerHTML = `
                        <div class="feedback-box trying">
                            That doesn't match. The answer is: <strong>${generatedAnswer}</strong>
                            <br>Try another problem to practice more!
                        </div>`;
                }
            }
        }

        // Geometric View functions
        function showConversionFormulas() {
            const formulas = `\\begin{align}
                \\text{Rectangular to Polar:} \\quad r &= \\sqrt{a^2 + b^2} \\\\
                \\theta &= \\arctan\\left(\\frac{b}{a}\\right) \\\\
                \\text{Polar to Rectangular:} \\quad a &= r\\cos\\theta \\\\
                b &= r\\sin\\theta
            \\end{align}`;
            
            katex.render(formulas, document.getElementById('conversion-formulas'), {
                displayMode: true,
                throwOnError: false
            });
        }

        function showMultiplicationFormulas() {
            katex.render("(a+bi)(c+di) = (ac-bd) + (ad+bc)i", 
                document.getElementById('rect-mult-formula'), {
                displayMode: true,
                throwOnError: false
            });
            
            katex.render("r_1(\\cos\\theta_1 + i\\sin\\theta_1) \\cdot r_2(\\cos\\theta_2 + i\\sin\\theta_2) = r_1r_2(\\cos(\\theta_1+\\theta_2) + i\\sin(\\theta_1+\\theta_2))", 
                document.getElementById('polar-mult-formula'), {
                displayMode: true,
                throwOnError: false
            });
        }

        function initInteractivePlane() {
            const canvas = document.getElementById('representation-plane');
            if (!canvas) return;
            
            canvas.addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                const scale = 40;
                
                const real = (x - centerX) / scale;
                const imag = -(y - centerY) / scale;
                
                drawComplexNumber(real, imag);
            });
            
            // Draw initial number
            drawComplexNumber(3, 4);
        }

        function drawComplexNumber(real, imag) {
            const canvas = document.getElementById('representation-plane');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = -4; i <= 4; i++) {
                const x = centerX + i * scale;
                const y = centerY - i * scale;
                
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw the complex number
            const x = centerX + real * scale;
            const y = centerY - imag * scale;
            
            // Draw vector
            ctx.strokeStyle = '#0f766e';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // Draw angle arc
            const r = Math.sqrt(real * real + imag * imag);
            const theta = Math.atan2(imag, real);
            
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, -theta, true);
            ctx.stroke();
            
            // Draw point
            ctx.fillStyle = '#0f766e';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Update displays
            const rectDisplay = document.getElementById('rect-display');
            const polarDisplay = document.getElementById('polar-display');
            
            // Rectangular form
            rectDisplay.textContent = `${real.toFixed(2)} ${imag >= 0 ? '+' : '-'} ${Math.abs(imag).toFixed(2)}i`;
            
            // Polar form
            const thetaDeg = (theta * 180 / Math.PI);
            polarDisplay.textContent = `${r.toFixed(2)}(cos ${thetaDeg.toFixed(1)}° + i sin ${thetaDeg.toFixed(1)}°)`;
        }

        // Exploration functions
        function loadExplorationProblem() {
            const problem = explorationProblems[currentExplorationIndex];
            const display = document.getElementById('exploration-problem');
            
            katex.render(problem.problem, display, {
                displayMode: false,
                throwOnError: false
            });
        }

        function showBothApproaches() {
            const problem = explorationProblems[currentExplorationIndex];
            const comparison = document.getElementById('approach-comparison');
            const rectApproach = document.getElementById('rect-approach');
            const polarApproach = document.getElementById('polar-approach');
            const feedback = document.getElementById('approach-feedback');
            
            comparison.style.display = 'block';
            
            // Show different approaches based on problem type
            if (problem.type === 'addition') {
                rectApproach.innerHTML = '<p>Simply add components:<br>(2+3i) + (1-2i) = 3 + i<br>Quick and easy!</p>';
                polarApproach.innerHTML = '<p>Convert to polar, then...<br>Actually quite complicated!<br>Need to convert back to add.</p>';
                feedback.textContent = 'Rectangular form is clearly better for addition and subtraction!';
            } else if (problem.type === 'power') {
                rectApproach.innerHTML = '<p>Multiply 10 times:<br>(1+i)(1+i) = 2i<br>(2i)(1+i) = -2 + 2i<br>... many steps!</p>';
                polarApproach.innerHTML = '<p>Convert: 1+i = √2∠45°<br>Power: (√2)^10 ∠(10×45°)<br>= 32∠450° = 32∠90° = 32i<br>Much simpler!</p>';
                feedback.textContent = 'Polar form is much better for powers and roots!';
            } else if (problem.type === 'division') {
                rectApproach.innerHTML = '<p>Multiply by conjugate:<br>(3+4i)(1+i) / (1-i)(1+i)<br>= (3+3i+4i+4i²) / 2<br>= (-1+7i) / 2</p>';
                polarApproach.innerHTML = '<p>Convert both to polar<br>Divide magnitudes, subtract angles<br>Convert back if needed</p>';
                feedback.textContent = 'Both methods work well for division - choose based on the numbers!';
            }
        }

        function nextExplorationProblem() {
            currentExplorationIndex = (currentExplorationIndex + 1) % explorationProblems.length;
            loadExplorationProblem();
            document.getElementById('approach-comparison').style.display = 'none';
            document.querySelectorAll('input[name="form-choice"]').forEach(r => r.checked = false);
        }

        function updateRootsDisplay() {
            const n = document.getElementById('n-value').value;
            
            const eqDisplay = document.getElementById('roots-equation');
            katex.render(`z^{${n}} = 1`, eqDisplay, {
                displayMode: false,
                throwOnError: false
            });
        }

        function findRoots() {
            const n = parseInt(document.getElementById('n-value').value);
            const resultDiv = document.getElementById('roots-result');
            const listDiv = document.getElementById('roots-list');
            const eqDisplay = document.getElementById('roots-eq-display');
            
            resultDiv.style.display = 'block';
            
            katex.render(`z^{${n}} = 1`, eqDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            // Calculate roots of unity
            let rootsHtml = '';
            for (let k = 0; k < n; k++) {
                const angle = 2 * Math.PI * k / n;
                const angleDeg = (360 * k / n).toFixed(0);
                rootsHtml += `<p>z_{${k}} = \\cos ${angleDeg}° + i\\sin ${angleDeg}°</p>`;
            }
            
            listDiv.innerHTML = rootsHtml;
            
            // Render all formulas
            listDiv.querySelectorAll('p').forEach(p => {
                const text = p.textContent;
                katex.render(text, p, {
                    displayMode: false,
                    throwOnError: false
                });
            });
            
            // Draw on canvas
            drawRootsPlane(n);
        }

        function drawRootsPlane(n) {
            const canvas = document.getElementById('roots-plane');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 100;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw unit circle
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(centerX, centerY, scale, 0, 2 * Math.PI);
            ctx.stroke();
            
            // Draw roots
            for (let k = 0; k < n; k++) {
                const angle = 2 * Math.PI * k / n;
                const x = centerX + Math.cos(angle) * scale;
                const y = centerY - Math.sin(angle) * scale;
                
                // Draw line from origin
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw point
                ctx.fillStyle = '#0f766e';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // Label
                ctx.fillStyle = '#212121';
                ctx.font = '12px sans-serif';
                ctx.fillText(`z${k}`, x + 8, y - 8);
            }
            
            // Connect roots to form polygon
            if (n > 2) {
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 1;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                for (let k = 0; k <= n; k++) {
                    const angle = 2 * Math.PI * k / n;
                    const x = centerX + Math.cos(angle) * scale;
                    const y = centerY - Math.sin(angle) * scale;
                    if (k === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
        }
    </script>
</body>
</html>
