<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complex Numbers - Mathswell</title>
    <link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
    <link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f7faf9;
            color: #212121;
            line-height: 1.6;
        }

        /* Mathswell Navigation */
        .mathswell-nav {
            display: flex;
            justify-content: center;
            margin: .75rem 0 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .mathswell-nav .mw-link {
            display: inline-flex;
            align-items: center;
            gap: .45rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            color: #0f766e;
            padding: .3rem .7rem;
            border-radius: 999px;
            background: rgba(255,255,255,.95);
            box-shadow: 0 2px 8px rgba(0,0,0,.08);
            transition: all 0.3s ease;
        }

        .mathswell-nav .mw-link:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,.12);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #4b5563;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: #e6fffb;
        }

        .tab-button.active {
            background: #0f766e;
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards and Sections */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .intro-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .intro-header h1 {
            font-size: 2.5em;
            color: #0f766e;
            margin-bottom: 8px;
        }

        .intro-header p {
            font-size: 1.2em;
            color: #4b5563;
        }

        .concept-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .concept-card {
            background: linear-gradient(135deg, #e6fffb 0%, #f0fffe 100%);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .concept-card h3 {
            color: #0f766e;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        /* Interactive Demo */
        .interactive-demo {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .demo-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 200px;
        }

        .slider-group label {
            font-weight: 600;
            color: #4b5563;
            min-width: 30px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0f766e;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0f766e;
            cursor: pointer;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: #0f766e;
        }

        .demo-button {
            padding: 10px 20px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            background: #10b981;
            transform: translateY(-1px);
        }

        .demo-result {
            background: #e6fffb;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }

        .math-display {
            margin: 8px 0;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }

        .nav-btn {
            padding: 14px 28px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 999px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #10b981;
            transform: translateX(4px);
        }

        /* Algebraic Explorer Styles */
        .expression-input-group {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .expression-display {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .user-answer-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
        }

        .user-answer-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .preset-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .preset-pill {
            padding: 8px 16px;
            background: #e6fffb;
            border: 2px solid #10b981;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            color: #0f766e;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preset-pill:hover {
            background: #10b981;
            color: white;
        }

        .result-display {
            background: #e6fffb;
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-display h3 {
            color: #0f766e;
            margin-bottom: 12px;
        }

        .feedback-box {
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .feedback-box.match {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }

        .feedback-box.no-match {
            background: #fed7aa;
            border: 2px solid #fb923c;
            color: #9a3412;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .secondary-button {
            padding: 10px 20px;
            background: #4b5563;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .secondary-button:hover {
            background: #6b7280;
        }

        /* Complex Plane Canvas */
        .plane-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .geometry-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .geometry-grid {
                grid-template-columns: 1fr;
            }
        }

        canvas {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            cursor: crosshair;
        }

        .plane-controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-button {
            padding: 10px 20px;
            background: #0f766e;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: #10b981;
        }

        .control-button.secondary {
            background: #4b5563;
        }

        .control-button.secondary:hover {
            background: #6b7280;
        }

        /* Info boxes */
        .info-box {
            background: #f0fffe;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #0f766e;
            margin-bottom: 8px;
        }

        .representation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .rep-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .rep-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .rep-card h4 {
            color: #0f766e;
            margin-bottom: 8px;
        }

        /* Loading and AI status */
        .ai-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #e6fffb;
            border-radius: 999px;
            font-size: 13px;
            color: #0f766e;
            margin-left: 12px;
        }

        .loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid #10b981;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Disclaimer */
        .disclaimer {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 14px;
            color: #92400e;
        }

        /* Steps display */
        .steps-container {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .step {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .step:last-child {
            border-bottom: none;
        }

        /* Equation solver specific */
        .roots-display {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
        }

        .root-item {
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .root-value {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #0f766e;
        }

        .form-selector {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .form-choice {
            display: flex;
            gap: 16px;
            margin-top: 12px;
        }

        .form-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .form-radio input[type="radio"] {
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .intro-header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
            }
            
            .geometry-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Mathswell Navigation -->
    <div class="mathswell-nav">
        <a href="/" class="mw-link">
            <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
            <span>MATHSWELL</span>
        </a>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" data-tab="introduction">Introduction</button>
            <button class="tab-button" data-tab="algebraic">Algebraic Explorer</button>
            <button class="tab-button" data-tab="geometric">Geometric View</button>
            <button class="tab-button" data-tab="exploration">Exploration</button>
        </div>

        <!-- Introduction Tab -->
        <div id="introduction" class="tab-content active">
            <div class="intro-header">
                <h1>Complex Numbers</h1>
                <p>Impossible numbers that create endless possibilities</p>
            </div>

            <!-- Concept Cards -->
            <div class="concept-cards">
                <div class="concept-card">
                    <h3>The Imaginary Unit <em>i</em></h3>
                    <p>We define <strong><em>i</em></strong> as something whose square is -1:</p>
                    <div class="math-display" id="i-definition"></div>
                    <p>This "impossible" idea unlocks a whole new mathematical universe!</p>
                </div>

                <div class="concept-card">
                    <h3>Complex Numbers: a + bi</h3>
                    <p>Every complex number combines real and imaginary parts:</p>
                    <div class="math-display" id="complex-form"></div>
                    <p>They follow all arithmetic rules, always simplifying to this form.</p>
                </div>

                <div class="concept-card">
                    <h3>Historical Breakthrough</h3>
                    <p>Girolamo Cardano faced equations like <span id="cardano-eq"></span></p>
                    <p>Completing the square gives us a negative under the square root - leading to complex solutions!</p>
                </div>
            </div>

            <!-- Interactive Demo 1: Factoring x² + c -->
            <div class="interactive-demo">
                <h2>Factoring <span id="factor-header"></span></h2>
                <p>See how complex numbers let us factor any quadratic, even when c is positive!</p>
                
                <div class="demo-controls">
                    <div class="slider-group">
                        <label>c =</label>
                        <input type="range" class="slider" id="c-slider" min="-10" max="10" value="1" step="1">
                        <span class="slider-value" id="c-value">1</span>
                    </div>
                </div>
                
                <div class="demo-result">
                    <div class="math-display" id="factor-display"></div>
                    <div class="math-display" id="factor-roots"></div>
                </div>
            </div>

            <!-- Interactive Demo 2: Cardano's Equation - Full Width -->
            <div class="interactive-demo">
                <h2>Solving the Unsolvable: Cardano's Challenge</h2>
                <p>The historic equation <span id="cardano-display"></span> that led to accepting complex numbers</p>
                
                <div class="demo-result">
                    <div class="math-display" id="cardano-complete"></div>
                    <div class="math-display" id="cardano-solution"></div>
                    <div class="math-display" id="cardano-roots"></div>
                </div>
                
                <div style="margin-top: 20px;">
                    <p><strong>Try your own quadratic:</strong></p>
                    <div class="demo-controls">
                        <div class="slider-group">
                            <label>b =</label>
                            <input type="range" class="slider" id="b-slider" min="-10" max="10" value="-10" step="1">
                            <span class="slider-value" id="b-value">-10</span>
                        </div>
                        <div class="slider-group">
                            <label>c =</label>
                            <input type="range" class="slider" id="c2-slider" min="1" max="50" value="40" step="1">
                            <span class="slider-value" id="c2-value">40</span>
                        </div>
                    </div>
                    
                    <div class="demo-result">
                        <div class="math-display" id="quadratic-equation"></div>
                        <div class="math-display" id="discriminant-display"></div>
                        <div class="math-display" id="quadratic-roots"></div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons">
                <button class="nav-btn" onclick="switchTab('algebraic')">
                    Try Algebraic Explorer →
                </button>
                <button class="nav-btn" onclick="switchTab('geometric')">
                    Explore Geometry →
                </button>
                <button class="nav-btn" onclick="switchTab('exploration')">
                    Explore Equations →
                </button>
            </div>
        </div>

        <!-- Algebraic Explorer Tab -->
        <div id="algebraic" class="tab-content">
            <div class="card">
                <h2>Algebraic Explorer</h2>
                <p>Practice simplifying complex expressions to standard form a + bi</p>
                
                <div class="info-box">
                    <h4>Remember: The algebra is exactly the same!</h4>
                    <p>All the algebraic rules you've learned still apply. The only new rule: whenever you see <span id="i-squared"></span>, replace it with -1.</p>
                </div>
                
                <div class="disclaimer">
                    ⚡ AI-powered checking - The AI helper can make mistakes and may be temporarily unavailable during periods of high traffic
                </div>
            </div>

            <div class="expression-input-group">
                <h3>Current Expression</h3>
                <div class="expression-display" id="current-expression-display"></div>
                
                <div class="preset-pills">
                    <button class="preset-pill" onclick="loadExample('multiply')">Try: (2+3i) × (1-i)</button>
                    <button class="preset-pill" onclick="loadExample('divide')">Try: (3+2i) ÷ (1-i)</button>
                    <button class="preset-pill" onclick="loadExample('power')">Try: (1+i)⁴</button>
                    <button class="preset-pill" onclick="loadExample('complex')">Try: ((2+i)(3-2i))/(1+i)</button>
                </div>
                
                <h4 style="margin-top: 20px;">Your Answer (in form a + bi):</h4>
                <input type="text" class="user-answer-input" id="user-answer" 
                       placeholder="Enter your answer, e.g., 5 + i or 3 - 2i">
                
                <div class="button-group">
                    <button class="demo-button" onclick="checkAnswer()">
                        Check Answer <span class="ai-status" id="ai-status" style="display:none;"><span class="loading-spinner"></span> Checking...</span>
                    </button>
                    <button class="secondary-button" onclick="showAISolution()" id="solution-btn">
                        See AI's Solution
                    </button>
                </div>
            </div>

            <div class="result-display" id="algebraic-result" style="display:none;">
                <h3>Feedback</h3>
                <div id="feedback-content"></div>
                <div class="steps-container" id="steps-container" style="display:none;">
                    <h4>Step-by-Step Solution</h4>
                    <div id="solution-steps"></div>
                </div>
            </div>
        </div>

        <!-- Geometric View Tab -->
        <div id="geometric" class="tab-content">
            <div class="card">
                <h2>Two Forms, One Number</h2>
                <div class="plane-container">
                    <h3>Complex Number Representations</h3>
                    <p>Every complex number can be expressed in two equivalent forms:</p>
                    <canvas id="representation-plane" width="400" height="400"></canvas>
                    <div id="rep-info" style="text-align: center; margin-top: 16px;">
                        <div><strong>Rectangular:</strong> <span id="rect-form">3 + 4i</span></div>
                        <div><strong>Polar:</strong> <span id="polar-form">5∠53.13°</span></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Multiplication: Two Perspectives</h2>
                <div class="info-box">
                    <h4>Rectangular Form</h4>
                    <p>(a+bi)(c+di) = (ac-bd) + (ad+bc)i - Use FOIL and replace i² with -1</p>
                </div>
                <div class="info-box">
                    <h4>Polar Form</h4>
                    <p>r₁∠θ₁ × r₂∠θ₂ = (r₁×r₂)∠(θ₁+θ₂) - Multiply magnitudes, add angles!</p>
                    <p><strong>This reveals the geometric magic:</strong> Multiplication is rotation and scaling!</p>
                </div>
            </div>

            <div class="geometry-grid">
                <!-- Addition/Subtraction Plane -->
                <div class="plane-container">
                    <h3>Addition & Subtraction</h3>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">
                        Best in rectangular form: just add/subtract components
                    </p>
                    <canvas id="addition-plane" width="350" height="350"></canvas>
                    <div class="plane-controls">
                        <button class="control-button" onclick="addNumberToAdditionPlane()">Add Random</button>
                        <button class="control-button" onclick="showAddition()">Show Sum</button>
                        <button class="control-button" onclick="showSubtraction()">Show Difference</button>
                        <button class="control-button secondary" onclick="clearAdditionPlane()">Clear</button>
                    </div>
                    <div id="addition-info" style="margin-top: 12px; text-align: center; font-size: 14px; word-wrap: break-word;"></div>
                </div>

                <!-- Multiplication/Division Plane -->
                <div class="plane-container">
                    <h3>Multiplication & Division</h3>
                    <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">
                        Best in polar form: multiply/divide magnitudes, add/subtract angles
                    </p>
                    <canvas id="multiplication-plane" width="350" height="350"></canvas>
                    <div class="plane-controls">
                        <button class="control-button" onclick="addNumberToMultPlane()">Add Random</button>
                        <button class="control-button" onclick="showMultiplication()">Show Product</button>
                        <button class="control-button" onclick="showDivision()">Show Quotient</button>
                        <button class="control-button secondary" onclick="clearMultPlane()">Clear</button>
                    </div>
                    <div id="mult-info" style="margin-top: 12px; text-align: center; font-size: 14px; word-wrap: break-word;"></div>
                </div>
            </div>
        </div>

        <!-- Exploration Tab -->
        <div id="exploration" class="tab-content">
            <div class="card">
                <h2>Equation Exploration</h2>
                <p>Explore nth roots of complex numbers - choose your approach!</p>
                
                <div class="disclaimer">
                    ⚡ AI-powered solver - The AI helper can make mistakes and may be temporarily unavailable during periods of high traffic
                </div>
            </div>

            <div class="card">
                <h3>Solve <span id="equation-display"></span></h3>
                
                <div class="form-selector">
                    <h4>Which form should we use?</h4>
                    <p>Hint: For powers and roots, polar form reveals the pattern!</p>
                    <div class="form-choice">
                        <label class="form-radio">
                            <input type="radio" name="form" value="polar" checked>
                            Polar Form (recommended for roots)
                        </label>
                        <label class="form-radio">
                            <input type="radio" name="form" value="rectangular">
                            Rectangular Form (harder for high powers)
                        </label>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label style="font-weight: 600;">n = </label>
                            <input type="number" id="n-value" value="4" min="2" max="12" 
                                   style="width: 60px; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px;"
                                   onchange="updateEquationButton()">
                        </div>
                        
                        <div style="flex: 1; min-width: 200px;">
                            <label style="font-weight: 600;">c = </label>
                            <input type="text" id="c-complex" placeholder="e.g., 1, -1, i, 2+2i" value="1" 
                                   style="width: 200px; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px;"
                                   onchange="updateEquationButton()">
                        </div>
                    </div>
                    
                    <div class="preset-pills" style="margin-top: 16px;">
                        <button class="preset-pill" onclick="setRootEquation(3, '1')">Cube roots of unity</button>
                        <button class="preset-pill" onclick="setRootEquation(4, '1')">4th roots of unity</button>
                        <button class="preset-pill" onclick="setRootEquation(6, '1')">6th roots of unity</button>
                        <button class="preset-pill" onclick="setRootEquation(4, '16')">4th roots of 16</button>
                        <button class="preset-pill" onclick="setRootEquation(3, '-8')">Cube roots of -8</button>
                        <button class="preset-pill" onclick="setRootEquation(2, 'i')">Square roots of i</button>
                    </div>
                    
                    <button class="demo-button" id="solve-button" onclick="solveRootEquation()" style="margin-top: 20px; width: 100%;">
                        <span id="solve-button-text">Find All Roots</span> 
                        <span class="ai-status" id="root-status" style="display:none;"><span class="loading-spinner"></span></span>
                    </button>
                </div>
                
                <div id="root-results" style="display:none; margin-top: 24px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="roots-display">
                            <h4>All n Solutions:</h4>
                            <div id="root-list"></div>
                        </div>
                        
                        <div style="text-align: center;">
                            <canvas id="root-plane" width="300" height="300"></canvas>
                        </div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <h4>Geometric Pattern</h4>
                        <p id="root-pattern"></p>
                        <p style="margin-top: 12px;"><strong>Key insight:</strong> All roots have the same distance from origin (the nth root of |c|), 
                        and are evenly spaced by angle 2π/n.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTab = 'introduction';
        let currentExpression = '(2+3i)*(1-i)';
        let additionNumbers = [];
        let multiplicationNumbers = [];
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Render initial math formulas
            katex.render("i^2 = -1", document.getElementById('i-definition'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("z = a + bi", document.getElementById('complex-form'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("x^2 - 10x + 40 = 0", document.getElementById('cardano-eq'), {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render("x^2 - 10x + 40 = 0", document.getElementById('cardano-display'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Render headers
            katex.render("x^2 + c", document.getElementById('factor-header'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Algebraic tab
            katex.render("i^2", document.getElementById('i-squared'), {
                displayMode: false,
                throwOnError: false
            });
            
            // Initialize displays
            updateFactoring();
            showCardanoSolution();
            updateQuadratic();
            loadExample('multiply');
            drawRepresentationPlane();
            updateEquationButton();
            
            // Add slider listeners
            document.getElementById('c-slider').addEventListener('input', updateFactoring);
            document.getElementById('b-slider').addEventListener('input', updateQuadratic);
            document.getElementById('c2-slider').addEventListener('input', updateQuadratic);
            
            // Initialize canvases
            if (currentTab === 'geometric') {
                initGeometricPlanes();
            }
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
            
            if (tabName === 'geometric') {
                setTimeout(() => {
                    drawRepresentationPlane();
                    initGeometricPlanes();
                }, 100);
            }
        }

        // Add tab button listeners
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        // Fallback for manual calculation when AI fails
        function manualSimplify(expr) {
            // Basic simplification for common cases
            if (expr === '(2+3i)*(1-i)') return '5 + i';
            if (expr === '(3+2i)/(1-i)') return '0.5 + 2.5i';
            if (expr === '(1+i)^4') return '-4 + 0i';
            return 'Please calculate manually';
        }

        // Introduction tab functions
        function updateFactoring() {
            const c = parseInt(document.getElementById('c-slider').value);
            document.getElementById('c-value').textContent = c;
            
            const factorDisplay = document.getElementById('factor-display');
            const rootsDisplay = document.getElementById('factor-roots');
            
            let factorLatex, rootsLatex;
            
            if (c > 0) {
                const sqrtC = Math.sqrt(c);
                let rootStr;
                if (Number.isInteger(sqrtC)) {
                    rootStr = sqrtC.toString();
                } else {
                    rootStr = `\\sqrt{${c}}`;
                }
                
                factorLatex = `x^2 + ${c} = \\left(x + ${rootStr}i\\right)\\left(x - ${rootStr}i\\right)`;
                rootsLatex = `\\text{Roots: } x = \\pm ${rootStr}i`;
            } else if (c < 0) {
                const absC = Math.abs(c);
                const sqrtAbsC = Math.sqrt(absC);
                let rootStr;
                if (Number.isInteger(sqrtAbsC)) {
                    rootStr = sqrtAbsC.toString();
                } else {
                    rootStr = `\\sqrt{${absC}}`;
                }
                
                factorLatex = `x^2 - ${absC} = \\left(x + ${rootStr}\\right)\\left(x - ${rootStr}\\right)`;
                rootsLatex = `\\text{Roots: } x = \\pm ${rootStr}`;
            } else {
                factorLatex = `x^2 = x \\cdot x`;
                rootsLatex = `\\text{Root: } x = 0 \\text{ (double root)}`;
            }
            
            katex.render(factorLatex, factorDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            katex.render(rootsLatex, rootsDisplay, {
                displayMode: false,
                throwOnError: false
            });
        }

        function showCardanoSolution() {
            const completeDisplay = document.getElementById('cardano-complete');
            const solutionDisplay = document.getElementById('cardano-solution');
            const rootsDisplay = document.getElementById('cardano-roots');
            
            // Complete the square
            katex.render("\\text{Complete the square: } (x-5)^2 = x^2 - 10x + 25", completeDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            // Show the negative result
            katex.render("\\text{So: } x^2 - 10x + 40 = 0 \\Rightarrow (x-5)^2 = -15", solutionDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            // Show the complex roots using factoring idea
            katex.render("x - 5 = \\pm\\sqrt{-15} = \\pm\\sqrt{15}i \\quad \\Rightarrow \\quad x = 5 \\pm \\sqrt{15}i", rootsDisplay, {
                displayMode: false,
                throwOnError: false
            });
        }

        function updateQuadratic() {
            const b = parseInt(document.getElementById('b-slider').value);
            const c = parseInt(document.getElementById('c2-slider').value);
            document.getElementById('b-value').textContent = b;
            document.getElementById('c2-value').textContent = c;
            
            const equationDisplay = document.getElementById('quadratic-equation');
            const discriminantDisplay = document.getElementById('discriminant-display');
            const rootsDisplay = document.getElementById('quadratic-roots');
            
            // Display equation
            const bStr = b === 0 ? '' : (b > 0 ? `+ ${b}x` : `- ${Math.abs(b)}x`);
            const cStr = c === 0 ? '' : (c > 0 ? `+ ${c}` : `- ${Math.abs(c)}`);
            const eqLatex = `x^2 ${bStr} ${cStr} = 0`;
            
            katex.render(eqLatex, equationDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            // Calculate discriminant
            const disc = b * b - 4 * c;
            let discLatex = `\\text{Discriminant: } ${b}^2 - 4(${c}) = ${disc}`;
            
            katex.render(discLatex, discriminantDisplay, {
                displayMode: false,
                throwOnError: false
            });
            
            // Calculate roots
            let rootsLatex;
            if (disc < 0) {
                const absDisc = Math.abs(disc);
                const sqrtAbsDisc = Math.sqrt(absDisc);
                
                if (Number.isInteger(sqrtAbsDisc) && sqrtAbsDisc % 2 === 0) {
                    const realPart = -b / 2;
                    const imagPart = sqrtAbsDisc / 2;
                    rootsLatex = `x = ${realPart} \\pm ${imagPart}i`;
                } else if (Number.isInteger(absDisc)) {
                    rootsLatex = `x = \\frac{${-b} \\pm \\sqrt{${absDisc}}i}{2}`;
                } else {
                    const realPart = (-b / 2).toFixed(2);
                    const imagPart = (sqrtAbsDisc / 2).toFixed(2);
                    rootsLatex = `x = ${realPart} \\pm ${imagPart}i`;
                }
            } else if (disc > 0) {
                const sqrtDisc = Math.sqrt(disc);
                if (Number.isInteger(sqrtDisc)) {
                    const root1 = (-b + sqrtDisc) / 2;
                    const root2 = (-b - sqrtDisc) / 2;
                    rootsLatex = `x = ${root1}, ${root2}`;
                } else if (Number.isInteger(disc)) {
                    rootsLatex = `x = \\frac{${-b} \\pm \\sqrt{${disc}}}{2}`;
                } else {
                    const root1 = ((-b + sqrtDisc) / 2).toFixed(2);
                    const root2 = ((-b - sqrtDisc) / 2).toFixed(2);
                    rootsLatex = `x = ${root1}, ${root2}`;
                }
            } else {
                const root = -b / 2;
                rootsLatex = `x = ${root}`;
            }
            
            katex.render(rootsLatex, rootsDisplay, {
                displayMode: false,
                throwOnError: false
            });
        }

        // Algebraic Explorer functions
        function loadExample(type) {
            const expressions = {
                'multiply': '(2+3i)*(1-i)',
                'divide': '(3+2i)/(1-i)',
                'power': '(1+i)^4',
                'complex': '((2+i)*(3-2i))/(1+i)'
            };
            
            currentExpression = expressions[type];
            const display = document.getElementById('current-expression-display');
            
            // Display in nice format
            let latex = currentExpression
                .replace(/\*/g, ' \\cdot ')
                .replace(/\//g, ' \\div ')
                .replace(/\^4/g, '^{4}');
            
            katex.render(latex, display, {
                displayMode: false,
                throwOnError: false
            });
            
            // Clear previous answer
            document.getElementById('user-answer').value = '';
            document.getElementById('algebraic-result').style.display = 'none';
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('user-answer').value;
            const resultEl = document.getElementById('algebraic-result');
            const feedbackEl = document.getElementById('feedback-content');
            
            if (!userAnswer) {
                alert('Please enter your answer');
                return;
            }
            
            // Use fallback calculation
            const correctAnswer = manualSimplify(currentExpression);
            
            feedbackEl.innerHTML = '';
            
            // Simple check (this is a fallback when AI is not available)
            const userNormalized = userAnswer.replace(/\s/g, '').toLowerCase();
            const correctNormalized = correctAnswer.replace(/\s/g, '').toLowerCase();
            
            if (userNormalized === correctNormalized) {
                const feedbackBox = document.createElement('div');
                feedbackBox.className = 'feedback-box match';
                feedbackBox.innerHTML = `
                    <strong>Excellent! We are in agreement.</strong>
                    <div style="margin-top: 8px;">Your answer ${userAnswer} is correct!</div>
                    <div style="margin-top: 8px;">If you would like to see my solution, click "See AI's Solution" above.</div>
                `;
                feedbackEl.appendChild(feedbackBox);
            } else {
                const feedbackBox = document.createElement('div');
                feedbackBox.className = 'feedback-box no-match';
                feedbackBox.innerHTML = `
                    <strong>Our answers don't match.</strong>
                    <div style="margin-top: 8px;">I got: <strong>${correctAnswer}</strong></div>
                    <div style="margin-top: 8px;">Please check your calculation, remembering that i² = -1.</div>
                    <div style="margin-top: 8px;">Click "See AI's Solution" to see how I solved it step by step.</div>
                `;
                feedbackEl.appendChild(feedbackBox);
            }
            
            resultEl.style.display = 'block';
        }

        function showAISolution() {
            const stepsContainer = document.getElementById('steps-container');
            const stepsEl = document.getElementById('solution-steps');
            
            // Provide manual solution steps
            let steps = [];
            if (currentExpression === '(2+3i)*(1-i)') {
                steps = [
                    'Use FOIL: (2+3i)(1-i)',
                    'First: 2·1 = 2',
                    'Outer: 2·(-i) = -2i',
                    'Inner: 3i·1 = 3i',
                    'Last: 3i·(-i) = -3i²',
                    'Remember i² = -1, so -3i² = -3(-1) = 3',
                    'Combine: 2 - 2i + 3i + 3 = 5 + i'
                ];
            } else if (currentExpression === '(1+i)^4') {
                steps = [
                    'Calculate (1+i)² first',
                    '(1+i)² = 1 + 2i + i² = 1 + 2i - 1 = 2i',
                    'Now calculate (2i)²',
                    '(2i)² = 4i² = 4(-1) = -4',
                    'So (1+i)⁴ = -4'
                ];
            } else {
                steps = ['Apply FOIL method', 'Replace i² with -1', 'Simplify to a + bi form'];
            }
            
            stepsEl.innerHTML = steps.map((step, i) => 
                `<div class="step">${i + 1}. ${step}</div>`
            ).join('');
            stepsContainer.style.display = 'block';
            
            document.getElementById('algebraic-result').style.display = 'block';
        }

        // Geometric View functions
        function drawRepresentationPlane() {
            const canvas = document.getElementById('representation-plane');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = -4; i <= 4; i++) {
                const x = centerX + i * scale;
                const y = centerY - i * scale;
                
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw example complex number z = 3 + 4i
            const real = 3;
            const imag = 4;
            const x = centerX + real * scale;
            const y = centerY - imag * scale;
            
            // Draw vector
            ctx.strokeStyle = '#0f766e';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // Draw angle arc
            const r = Math.sqrt(real * real + imag * imag);
            const theta = Math.atan2(imag, real);
            
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, -theta, true);
            ctx.stroke();
            
            // Draw projections
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            ctx.moveTo(x, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, y);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // Draw point
            ctx.fillStyle = '#0f766e';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Labels
            ctx.fillStyle = '#212121';
            ctx.font = '14px sans-serif';
            ctx.fillText('Real', width - 40, centerY - 10);
            ctx.fillText('Imaginary', centerX + 10, 20);
            ctx.fillText('3', x - 5, centerY + 20);
            ctx.fillText('4', centerX - 20, y + 5);
            ctx.fillText('r = 5', centerX + 35, centerY - 15);
            ctx.fillText('θ', centerX + 15, centerY - 5);
            
            // Update display
            document.getElementById('rect-form').textContent = '3 + 4i';
            document.getElementById('polar-form').textContent = '5∠53.13°';
        }

        function initGeometricPlanes() {
            drawAdditionPlane();
            drawMultiplicationPlane();
        }

        function drawAdditionPlane() {
            const canvas = document.getElementById('addition-plane');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = -4; i <= 4; i++) {
                const x = centerX + i * scale;
                const y = centerY - i * scale;
                
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw numbers
            additionNumbers.forEach((num, i) => {
                const x = centerX + num.real * scale;
                const y = centerY - num.imag * scale;
                
                ctx.strokeStyle = i === 0 ? '#0f766e' : '#10b981';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                ctx.fillStyle = i === 0 ? '#0f766e' : '#10b981';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#212121';
                ctx.font = '12px sans-serif';
                ctx.fillText(`z${i+1}`, x + 8, y - 8);
            });
        }

        function drawMultiplicationPlane() {
            const canvas = document.getElementById('multiplication-plane');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = -4; i <= 4; i++) {
                const x = centerX + i * scale;
                const y = centerY - i * scale;
                
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw unit circle
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, scale, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw numbers
            multiplicationNumbers.forEach((num, i) => {
                const x = centerX + num.real * scale;
                const y = centerY - num.imag * scale;
                const r = Math.sqrt(num.real * num.real + num.imag * num.imag);
                const theta = Math.atan2(num.imag, num.real);
                
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 20, 0, -theta, theta > 0);
                ctx.stroke();
                
                ctx.strokeStyle = i === 0 ? '#0f766e' : '#10b981';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                ctx.fillStyle = i === 0 ? '#0f766e' : '#10b981';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#212121';
                ctx.font = '11px sans-serif';
                const angle = (theta * 180 / Math.PI).toFixed(0);
                ctx.fillText(`z${i+1}: ${r.toFixed(1)}∠${angle}°`, x + 8, y - 8);
            });
        }

        // Addition/Subtraction functions
        function addNumberToAdditionPlane() {
            if (additionNumbers.length >= 2) {
                additionNumbers = [];
            }
            const real = Math.random() * 6 - 3;
            const imag = Math.random() * 6 - 3;
            additionNumbers.push({ real, imag });
            drawAdditionPlane();
            
            const info = document.getElementById('addition-info');
            if (additionNumbers.length === 2) {
                const z1 = additionNumbers[0];
                const z2 = additionNumbers[1];
                info.innerHTML = `z₁ = ${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i, 
                                 z₂ = ${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i`;
            }
        }

        function showAddition() {
            if (additionNumbers.length !== 2) {
                alert('Please add exactly 2 numbers first');
                return;
            }
            
            const z1 = additionNumbers[0];
            const z2 = additionNumbers[1];
            const sum = {
                real: z1.real + z2.real,
                imag: z1.imag + z2.imag
            };
            
            if (Math.abs(sum.real) > 4 || Math.abs(sum.imag) > 4) {
                document.getElementById('addition-info').innerHTML = 
                    `Sum: (${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i) + 
                    (${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i) = 
                    ${sum.real.toFixed(1)} + ${sum.imag.toFixed(1)}i <strong>(outside view)</strong>`;
                return;
            }
            
            const canvas = document.getElementById('addition-plane');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;
            
            const x = centerX + sum.real * scale;
            const y = centerY - sum.imag * scale;
            
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            document.getElementById('addition-info').innerHTML = 
                `Sum: (${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i) + 
                (${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i) = 
                ${sum.real.toFixed(1)} + ${sum.imag.toFixed(1)}i`;
        }

        function showSubtraction() {
            if (additionNumbers.length !== 2) {
                alert('Please add exactly 2 numbers first');
                return;
            }
            
            const z1 = additionNumbers[0];
            const z2 = additionNumbers[1];
            const diff = {
                real: z1.real - z2.real,
                imag: z1.imag - z2.imag
            };
            
            if (Math.abs(diff.real) > 4 || Math.abs(diff.imag) > 4) {
                document.getElementById('addition-info').innerHTML = 
                    `Difference: (${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i) - 
                    (${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i) = 
                    ${diff.real.toFixed(1)} + ${diff.imag.toFixed(1)}i <strong>(outside view)</strong>`;
                return;
            }
            
            drawAdditionPlane();
            
            const canvas = document.getElementById('addition-plane');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;
            
            const x = centerX + diff.real * scale;
            const y = centerY - diff.imag * scale;
            
            ctx.strokeStyle = '#c62828';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.fillStyle = '#c62828';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            document.getElementById('addition-info').innerHTML = 
                `Difference: (${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i) - 
                (${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i) = 
                ${diff.real.toFixed(1)} + ${diff.imag.toFixed(1)}i`;
        }

        function clearAdditionPlane() {
            additionNumbers = [];
            drawAdditionPlane();
            document.getElementById('addition-info').innerHTML = '';
        }

        // Multiplication/Division functions
        function addNumberToMultPlane() {
            if (multiplicationNumbers.length >= 2) {
                multiplicationNumbers = [];
            }
            const angle = Math.random() * 2 * Math.PI;
            const r = 0.5 + Math.random() * 2;
            const real = r * Math.cos(angle);
            const imag = r * Math.sin(angle);
            multiplicationNumbers.push({ real, imag });
            drawMultiplicationPlane();
            
            const info = document.getElementById('mult-info');
            if (multiplicationNumbers.length === 2) {
                const z1 = multiplicationNumbers[0];
                const z2 = multiplicationNumbers[1];
                const r1 = Math.sqrt(z1.real * z1.real + z1.imag * z1.imag);
                const r2 = Math.sqrt(z2.real * z2.real + z2.imag * z2.imag);
                const theta1 = Math.atan2(z1.imag, z1.real) * 180 / Math.PI;
                const theta2 = Math.atan2(z2.imag, z2.real) * 180 / Math.PI;
                info.innerHTML = `z₁: ${r1.toFixed(2)}∠${theta1.toFixed(0)}° | 
                                 z₂: ${r2.toFixed(2)}∠${theta2.toFixed(0)}°`;
            }
        }

        function showMultiplication() {
            if (multiplicationNumbers.length !== 2) {
                alert('Please add exactly 2 numbers first');
                return;
            }
            
            const z1 = multiplicationNumbers[0];
            const z2 = multiplicationNumbers[1];
            
            const r1 = Math.sqrt(z1.real * z1.real + z1.imag * z1.imag);
            const r2 = Math.sqrt(z2.real * z2.real + z2.imag * z2.imag);
            const theta1 = Math.atan2(z1.imag, z1.real);
            const theta2 = Math.atan2(z2.imag, z2.real);
            const rProduct = r1 * r2;
            const thetaProduct = theta1 + theta2;
            
            const product = {
                real: rProduct * Math.cos(thetaProduct),
                imag: rProduct * Math.sin(thetaProduct)
            };
            
            const info = document.getElementById('mult-info');
            
            if (Math.abs(product.real) > 4 || Math.abs(product.imag) > 4) {
                info.innerHTML = `Product in polar: ${rProduct.toFixed(2)}∠${(thetaProduct*180/Math.PI).toFixed(0)}°<br>
                                = (${r1.toFixed(2)} × ${r2.toFixed(2)})∠(${(theta1*180/Math.PI).toFixed(0)}° + ${(theta2*180/Math.PI).toFixed(0)}°)
                                <strong>(outside view)</strong>`;
                return;
            }
            
            drawMultiplicationPlane();
            
            const canvas = document.getElementById('multiplication-plane');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;
            
            const x = centerX + product.real * scale;
            const y = centerY - product.imag * scale;
            
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            info.innerHTML = `Product: ${rProduct.toFixed(2)}∠${(thetaProduct*180/Math.PI).toFixed(0)}°<br>
                            = (${r1.toFixed(2)} × ${r2.toFixed(2)})∠(${(theta1*180/Math.PI).toFixed(0)}° + ${(theta2*180/Math.PI).toFixed(0)}°)`;
        }

        function showDivision() {
            if (multiplicationNumbers.length !== 2) {
                alert('Please add exactly 2 numbers first');
                return;
            }
            
            const z1 = multiplicationNumbers[0];
            const z2 = multiplicationNumbers[1];
            
            if (z2.real === 0 && z2.imag === 0) {
                alert('Cannot divide by zero');
                return;
            }
            
            const r1 = Math.sqrt(z1.real * z1.real + z1.imag * z1.imag);
            const r2 = Math.sqrt(z2.real * z2.real + z2.imag * z2.imag);
            const theta1 = Math.atan2(z1.imag, z1.real);
            const theta2 = Math.atan2(z2.imag, z2.real);
            const rQuotient = r1 / r2;
            const thetaQuotient = theta1 - theta2;
            
            const quotient = {
                real: rQuotient * Math.cos(thetaQuotient),
                imag: rQuotient * Math.sin(thetaQuotient)
            };
            
            const info = document.getElementById('mult-info');
            
            if (Math.abs(quotient.real) > 4 || Math.abs(quotient.imag) > 4) {
                info.innerHTML = `Quotient in polar: ${rQuotient.toFixed(2)}∠${(thetaQuotient*180/Math.PI).toFixed(0)}°<br>
                                = (${r1.toFixed(2)} ÷ ${r2.toFixed(2)})∠(${(theta1*180/Math.PI).toFixed(0)}° - ${(theta2*180/Math.PI).toFixed(0)}°)
                                <strong>(outside view)</strong>`;
                return;
            }
            
            drawMultiplicationPlane();
            
            const canvas = document.getElementById('multiplication-plane');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;
            
            const x = centerX + quotient.real * scale;
            const y = centerY - quotient.imag * scale;
            
            ctx.strokeStyle = '#c62828';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            ctx.fillStyle = '#c62828';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            info.innerHTML = `Quotient: ${rQuotient.toFixed(2)}∠${(thetaQuotient*180/Math.PI).toFixed(0)}°<br>
                            = (${r1.toFixed(2)} ÷ ${r2.toFixed(2)})∠(${(theta1*180/Math.PI).toFixed(0)}° - ${(theta2*180/Math.PI).toFixed(0)}°)`;
        }

        function clearMultPlane() {
            multiplicationNumbers = [];
            drawMultiplicationPlane();
            document.getElementById('mult-info').innerHTML = '';
        }

        // Exploration functions
        function updateEquationButton() {
            const n = document.getElementById('n-value').value;
            const c = document.getElementById('c-complex').value;
            const buttonText = document.getElementById('solve-button-text');
            const display = document.getElementById('equation-display');
            
            // Update button text
            buttonText.textContent = `Find All Roots of z^${n} = ${c}`;
            
            // Update equation display
            katex.render(`z^{${n}} = ${c}`, display, {
                displayMode: false,
                throwOnError: false
            });
        }

        function setRootEquation(n, c) {
            document.getElementById('n-value').value = n;
            document.getElementById('c-complex').value = c;
            updateEquationButton();
        }

        function solveRootEquation() {
            const n = parseInt(document.getElementById('n-value').value);
            const c = document.getElementById('c-complex').value;
            const form = document.querySelector('input[name="form"]:checked').value;
            const resultsEl = document.getElementById('root-results');
            const rootList = document.getElementById('root-list');
            const patternEl = document.getElementById('root-pattern');
            
            // Provide manual calculation for common cases
            rootList.innerHTML = '';
            
            if (c === '1' && n <= 6) {
                // Roots of unity
                for (let k = 0; k < n; k++) {
                    const angle = 2 * Math.PI * k / n;
                    const rootItem = document.createElement('div');
                    rootItem.className = 'root-item';
                    
                    const labelSpan = document.createElement('span');
                    katex.render(`z_{${k+1}}:`, labelSpan, {
                        displayMode: false,
                        throwOnError: false
                    });
                    
                    const valueSpan = document.createElement('span');
                    valueSpan.className = 'root-value';
                    
                    if (form === 'polar') {
                        valueSpan.textContent = `1∠${(angle * 180 / Math.PI).toFixed(0)}°`;
                    } else {
                        const real = Math.cos(angle);
                        const imag = Math.sin(angle);
                        valueSpan.textContent = `${real.toFixed(3)} + ${imag.toFixed(3)}i`;
                    }
                    
                    rootItem.appendChild(labelSpan);
                    rootItem.appendChild(valueSpan);
                    rootList.appendChild(rootItem);
                }
                
                patternEl.innerHTML = `The ${n} roots of unity form a regular ${n}-gon on the unit circle, 
                                       evenly spaced by angle 360°/${n} = ${(360/n).toFixed(1)}°`;
            } else {
                rootList.innerHTML = '<div class="root-item">Manual calculation needed for this equation.</div>';
                patternEl.innerHTML = 'All roots have the same modulus and are evenly spaced by angle 2π/n.';
            }
            
            // Draw on plane
            const canvas = document.getElementById('root-plane');
            if (c === '1') {
                const roots = [];
                for (let k = 0; k < n; k++) {
                    const angle = 2 * Math.PI * k / n;
                    roots.push({
                        real: Math.cos(angle),
                        imaginary: Math.sin(angle)
                    });
                }
                drawRootsOnPlane(canvas, roots);
            }
            
            resultsEl.style.display = 'block';
        }

        function drawRootsOnPlane(canvas, roots) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 60;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = -2; i <= 2; i++) {
                const x = centerX + i * scale;
                const y = centerY - i * scale;
                
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw unit circle
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, scale, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw axes
            ctx.strokeStyle = '#4b5563';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            // Draw roots
            roots.forEach((root, i) => {
                const x = centerX + root.real * scale;
                const y = centerY - root.imaginary * scale;
                
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle = '#0f766e';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#212121';
                ctx.font = '10px sans-serif';
                ctx.fillText(`z${i+1}`, x + 6, y - 6);
            });
            
            // Connect roots
            if (roots.length > 2) {
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 1;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                roots.forEach((root, i) => {
                    const x = centerX + root.real * scale;
                    const y = centerY - root.imaginary * scale;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.closePath();
                ctx.stroke();
                ctx.globalAlpha = 1;
            }
        }

        // Canvas click handlers
        document.getElementById('addition-plane')?.addEventListener('click', function(e) {
            if (additionNumbers.length >= 2) {
                additionNumbers = [];
            }
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = this.width / 2;
            const centerY = this.height / 2;
            const scale = 40;
            
            const real = (x - centerX) / scale;
            const imag = -(y - centerY) / scale;
            
            additionNumbers.push({ real, imag });
            drawAdditionPlane();
            
            const info = document.getElementById('addition-info');
            if (additionNumbers.length === 1) {
                info.innerHTML = `z₁ = ${real.toFixed(1)} + ${imag.toFixed(1)}i`;
            } else if (additionNumbers.length === 2) {
                const z1 = additionNumbers[0];
                const z2 = additionNumbers[1];
                info.innerHTML = `z₁ = ${z1.real.toFixed(1)} + ${z1.imag.toFixed(1)}i, 
                                 z₂ = ${z2.real.toFixed(1)} + ${z2.imag.toFixed(1)}i`;
            }
        });

        document.getElementById('multiplication-plane')?.addEventListener('click', function(e) {
            if (multiplicationNumbers.length >= 2) {
                multiplicationNumbers = [];
            }
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = this.width / 2;
            const centerY = this.height / 2;
            const scale = 40;
            
            const real = (x - centerX) / scale;
            const imag = -(y - centerY) / scale;
            
            multiplicationNumbers.push({ real, imag });
            drawMultiplicationPlane();
            
            const info = document.getElementById('mult-info');
            if (multiplicationNumbers.length === 2) {
                const z1 = multiplicationNumbers[0];
                const z2 = multiplicationNumbers[1];
                const r1 = Math.sqrt(z1.real * z1.real + z1.imag * z1.imag);
                const r2 = Math.sqrt(z2.real * z2.real + z2.imag * z2.imag);
                const theta1 = Math.atan2(z1.imag, z1.real) * 180 / Math.PI;
                const theta2 = Math.atan2(z2.imag, z2.real) * 180 / Math.PI;
                info.innerHTML = `z₁: ${r1.toFixed(2)}∠${theta1.toFixed(0)}° | 
                                 z₂: ${r2.toFixed(2)}∠${theta2.toFixed(0)}°`;
            }
        });
    </script>
</body>
</html>
